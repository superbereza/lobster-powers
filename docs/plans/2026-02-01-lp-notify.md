# lp-notify Implementation Plan

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans to implement this plan task-by-task.

**Goal:** Desktop notifications via system tools (notify-send on Linux, osascript on macOS).

**Architecture:** Simple CLI wrapper around platform-specific notification commands. No dependencies.

**Tech Stack:** Python stdlib only (subprocess, platform, argparse)

---

## Task 1: Create notify.py with basic notification

**Files:**
- Create: `src/lobster_powers/tools/notify.py`
- Modify: `pyproject.toml` (add entry point)

**Step 1: Write the implementation**

```python
#!/usr/bin/env python3
"""
lp-notify: Desktop notifications.

Examples:
    lp-notify "Hello world"
    lp-notify "Meeting in 5min" --title "Calendar"
    lp-notify "Deploy failed!" --urgency critical
"""

import argparse
import platform
import subprocess
import sys


def notify_linux(message: str, title: str, urgency: str, icon: str | None) -> bool:
    """Send notification via notify-send (Linux)."""
    cmd = ["notify-send"]

    if urgency:
        cmd.extend(["--urgency", urgency])

    if icon:
        cmd.extend(["--icon", icon])

    cmd.append(title)
    cmd.append(message)

    try:
        subprocess.run(cmd, check=True, capture_output=True)
        return True
    except FileNotFoundError:
        print("Error: notify-send not found. Install with: sudo apt install libnotify-bin", file=sys.stderr)
        return False
    except subprocess.CalledProcessError as e:
        print(f"Error: {e.stderr.decode() if e.stderr else 'notification failed'}", file=sys.stderr)
        return False


def notify_macos(message: str, title: str, urgency: str, icon: str | None) -> bool:
    """Send notification via osascript (macOS)."""
    # osascript doesn't support urgency or custom icons easily
    script = f'display notification "{message}" with title "{title}"'

    try:
        subprocess.run(["osascript", "-e", script], check=True, capture_output=True)
        return True
    except FileNotFoundError:
        print("Error: osascript not found", file=sys.stderr)
        return False
    except subprocess.CalledProcessError as e:
        print(f"Error: {e.stderr.decode() if e.stderr else 'notification failed'}", file=sys.stderr)
        return False


def notify(message: str, title: str = "ðŸ¦ž Lobster Powers", urgency: str = "normal", icon: str | None = None) -> bool:
    """Send desktop notification (cross-platform)."""
    system = platform.system()

    if system == "Linux":
        return notify_linux(message, title, urgency, icon)
    elif system == "Darwin":
        return notify_macos(message, title, urgency, icon)
    else:
        print(f"Error: unsupported platform {system}", file=sys.stderr)
        return False


def main():
    parser = argparse.ArgumentParser(
        description="Send desktop notifications",
        formatter_class=argparse.RawDescriptionHelpFormatter,
        epilog=__doc__,
    )
    parser.add_argument("message", help="Notification message")
    parser.add_argument("--title", "-t", default="ðŸ¦ž Lobster Powers", help="Notification title")
    parser.add_argument(
        "--urgency", "-u",
        choices=["low", "normal", "critical"],
        default="normal",
        help="Urgency level (Linux only)"
    )
    parser.add_argument("--icon", "-i", help="Icon path (Linux only)")

    args = parser.parse_args()

    success = notify(args.message, args.title, args.urgency, args.icon)
    sys.exit(0 if success else 1)


if __name__ == "__main__":
    main()
```

**Step 2: Add entry point to pyproject.toml**

Add to `[project.scripts]` section:
```toml
lp-notify = "lobster_powers.tools.notify:main"
```

**Step 3: Test manually**

```bash
cd /home/superbereza/dev/lobster-powers
pip install -e .
lp-notify "Test notification"
lp-notify "Critical!" --title "Alert" --urgency critical
```

Expected: Desktop notification appears

**Step 4: Commit**

```bash
git add src/lobster_powers/tools/notify.py pyproject.toml
git commit -m "feat(notify): add lp-notify desktop notifications"
```

---

## Task 2: Create skill file

**Files:**
- Create: `skills/notify.md`

**Step 1: Write skill file**

```markdown
---
name: notify
description: Send desktop notifications using lp-notify CLI
---

# Notify - Desktop Notifications

Use `lp-notify` to send desktop notifications to the user.

## Quick Examples

```bash
# Simple notification
lp-notify "Task completed!"

# With custom title
lp-notify "Build failed" --title "CI/CD"

# Urgent notification
lp-notify "Server down!" --urgency critical
```

## Commands

| Command | Description |
|---------|-------------|
| `lp-notify "message"` | Send notification |
| `lp-notify "msg" --title "Title"` | Custom title |
| `lp-notify "msg" --urgency critical` | Urgent (Linux) |
| `lp-notify "msg" --icon /path/icon.png` | Custom icon (Linux) |

## When to Use

- Task completed notifications
- Reminders (via lp-cron)
- Error alerts
- Status updates

## Platform Support

| Platform | Backend | Features |
|----------|---------|----------|
| Linux | notify-send | title, urgency, icon |
| macOS | osascript | title only |
```

**Step 2: Commit**

```bash
git add skills/notify.md
git commit -m "docs(notify): add skill file for AI agents"
```

---

## Summary

Total: 2 tasks, ~50 lines of code, ~30 lines of docs.

Estimated time: 10-15 minutes.
